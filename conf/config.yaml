defaults:  
  - _self_  

model:
  llm_name: "meta-llama/Meta-Llama-3-8B"
  cache_dir: "/data/horse/ws/s4610340-culture_agent/.cache"
  reranker_name: "BAAI/bge-reranker-v2-m3"  # Upgraded to v2-m3 for better quality
  embedding_model_name: "BAAI/bge-m3"
  # Predictor type: "discriminative" (NLL-based) or "generative" (text generation)
  predictor_type: "generative"
  # Parameters for generative predictor
  max_new_tokens: 15
  temperature: 0.0

ingestion:
  wikivoyage_xml_path: /data/horse/ws/s4610340-culture_agent/culture_questions_agent/data/wiki/datasets/wikivoyage.xml
  
  chunk_size: 256
  chunk_overlap: 50
  
  skip_wiki: false
  skip_web: false
  skip_training_data: false
  
  web_reader:
    _target_: culture_questions_agent.ingestion.web.WebSearchReader
    llm_name: ${model.llm_name}
    cache_dir: ${model.cache_dir}
    saq_path: "data/train_dataset_saq.csv"
    mcq_path: "data/train_dataset_mcq.csv"
    ddgs_backend: "yandex"
    max_results_per_query: 3
    max_workers: 10
    limit_questions_type: "mcq"

  lancedb_path: "storage/lancedb"

  # Country filtering (NEW) - Reduce dataset size
  country_filter_list: 
    - "China"
    - "Iran"
    - "United Kingdom"
    - "United States"
    - "US"
    - "UK"
  topic_templates:
    - "Culture of {}"
    - "Public holidays in {}"
    - "Customs and traditions of {}"
    - "Daily life in {}"
    - "Food culture in {}"
    - "Cuisine of {}"
    - "Education in {}"
    - "Education system in {}"
    - "School life in {}"
    - "Youth culture in {}"
    - "Employment in {}"
    - "Labor law in {}"
    - "Pensions in {}"
    - "Social security in {}"
    - "Economy of {}"
    - "Agriculture in {}"
    - "Demographics of {}"
    - "Religion in {}"
    - "Religious practices in {}"
    - "Sport in {}"
    - "Sports culture in {}"
    - "Olympic Games in {}"
    - "Leisure in {}"
    - "Media in {}"
    - "Transport in {}"
    - "Geography of {}"
    - "Child care in {}"
    - "Early childhood education in {}"
    - "Preschool education in {}"
    - "Family life in {}"

  # Additional Wikipedia pages to include beyond country-based templates
  additional_wikipedia_pages:
    - "Father's Day"
    - "Parents' Day"
    - "Gift"
    - "List of holidays"
    - "List of multinational festivals and holidays"
    - "Valentine's Day"
    - "English festivals"
    - "Family in China"
    - "Daily life in China"
    - "Chinese New Year"
    - "Spring Festival"
    - "Mid-Autumn Festival"
    - "Filial piety"
    - "Chinese social values"
    - "Gift-giving in China"
    - "Red envelope"
    - "Sport in China"
    - "Chinese sportspeople"
    - "Early childhood education in China"
    - "Family in Iran"
    - "Daily life in Iran"
    - "Islam in Iran"
    - "Shia Islam in Iran"
    - "Nowruz"
    - "Yalda Night"
    - "Taarof"
    - "Iranian etiquette"
    - "Gift-giving in Iran"
    - "Food culture in Iran"
    - "Sport in Iran"
    - "Wrestling in Iran"
    - "Public school (United Kingdom)"
    - "State school"
    - "After-school activity"
    - "Prom"
    - "Retirement age"
    - "Youth in Iran"
    - "List of secondary education systems by country"
    - "Middle school"

  auto_suggest: false

  training_mcq_path: "data/train_dataset_mcq.csv"
  training_saq_path: "data/train_dataset_saq.csv"

retrieval:
  # Multi-retriever configuration
  # use_colbert: true    # Late-interaction retrieval (PRIMARY)
  use_reranker: true   # Cross-encoder reranking
  
  use_wiki_retrieval: true  # Enable Wikipedia retrieval
  use_train_data_retrieval: true  # Enable training data retrieval
  use_web_retrieval: true
  
  # Reranking settings (cross-encoder)
  reranking_groups:
    - sources: ["train_data"]
      reranker:
        _target_: llama_index.postprocessor.flag_embedding_reranker.FlagEmbeddingReranker
        model: "BAAI/bge-reranker-v2-m3"
        top_n: 4
    - sources: ["wiki", "web"]
      reranker:
        _target_: llama_index.postprocessor.colbert_rerank.ColbertRerank
        top_n: 6
        device: "cuda:0"
        model: "colbert-ir/colbertv2.0"
        tokenizer: "colbert-ir/colbertv2.0"
        keep_retrieval_score: true
  
  wiki_top_k: 15
  web_top_k: 6
  train_data_top_k: 10

  # Legacy settings (for backward compatibility with existing code)
  # Query generation
  num_queries: 3  # Number of search queries to generate from question
  use_direct_question: false  # Use question directly for search instead of generating queries
  add_question_to_queries: true  # Append original question to generated queries


  # Web search settings (if web search is still used)
  max_search_chars: 1000  # Maximum characters to keep from search results
  include_title: false  # Include title in search snippets
  ddgs_backend: "yandex,yahoo,wikipedia,grokipedia"  # DDGS search backends to use


# Optional: Run test query after building index
run_test_query: false  # Set to true to validate retrieval system

evaluation:
  max_questions: null  # Maximum number of questions to evaluate (null = all questions)


mlflow:
  tracking_uri: "sqlite:///tracking/mlruns.sqlite"
  artifact_location: "tracking/artifacts"

# Task configuration
task_type: "mcq"  # Task type: "mcq" or "saq"

# Inference/Competition submission paths
test_mcq_path: "data/test_dataset_mcq.csv"
test_saq_path: "data/test_dataset_saq.csv"
submission_output_path: "data/mcq_prediction.tsv"
saq_submission_output_path: "data/saq_prediction.tsv"

# Inference optimization settings
inference:
  max_concurrent: 5
  num_processes: 0
